html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Penalty Pro: 1v1</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background: #1a2e1a;
            color: white;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow: hidden;
            touch-action: manipulation;
        }

        .pitch {
            position: relative;
            width: 100%;
            height: 100vh;
            background: radial-gradient(circle at bottom, #2d5a27 0%, #1a2e1a 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            padding: 20px;
        }

        .goal-post {
            position: relative;
            width: 80%;
            max-width: 600px;
            height: 250px;
            border: 8px solid white;
            border-bottom: none;
            margin-top: 50px;
            background: rgba(255, 255, 255, 0.1);
            display: grid;
            grid-template-areas: 
                "tl . tr"
                ". mid ."
                "bl . br";
            grid-template-columns: 100px 1fr 100px;
            grid-template-rows: 80px 1fr 80px;
        }

        .target-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: 3px dashed rgba(255, 255, 255, 0.5);
            background: rgba(0, 0, 0, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            justify-self: center;
            align-self: center;
        }

        .target-btn:hover {
            background: rgba(255, 255, 255, 0.4);
            transform: scale(1.1);
        }

        .target-btn.selected {
            background: #fbbf24;
            border-color: #f59e0b;
            box-shadow: 0 0 15px #fbbf24;
        }

        .ball-area {
            position: relative;
            bottom: 40px;
            cursor: pointer;
        }

        .ball {
            width: 60px;
            height: 60px;
            background: white;
            border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, #fff, #999);
            box-shadow: 0 10px 20px rgba(0,0,0,0.5);
            position: relative;
            z-index: 10;
        }

        .power-ring {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            border-radius: 50%;
            border: 4px solid;
            width: 120px;
            height: 120px;
            transition: border-color 0.1s;
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.85);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
            visibility: hidden;
            opacity: 0;
            transition: 0.3s;
        }

        .modal.active {
            visibility: visible;
            opacity: 1;
        }

        .score-board {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }

        .player-score {
            text-align: center;
            padding: 10px 20px;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            min-width: 120px;
        }

        .active-turn {
            border: 2px solid #fbbf24;
            background: rgba(251, 191, 36, 0.1);
        }

        .shot-dots {
            display: flex;
            gap: 4px;
            justify-content: center;
            margin-top: 5px;
        }

        .dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #444;
        }

        .dot.scored { background: #22c55e; }
        .dot.missed { background: #ef4444; }

        #action-msg {
            font-size: 1.2rem;
            font-weight: bold;
            text-transform: uppercase;
            margin: 10px 0;
            min-height: 3rem;
            color: #fbbf24;
            max-width: 80%;
            text-align: center;
        }

        .commentary-text {
            font-style: italic;
            font-size: 1rem;
            color: #ddd;
            margin-top: 4px;
            font-weight: normal;
        }

        input::placeholder {
            color: rgba(255,255,255,0.3);
        }
    </style>
</head>
<body>

    <!-- Setup Modal -->
    <div id="setup-modal" class="modal active">
        <div class="bg-zinc-900 p-8 rounded-2xl border-2 border-white max-w-sm w-full text-center">
            <h2 class="text-3xl font-black mb-6 italic text-yellow-500 underline">KICK OFF</h2>
            <div class="space-y-4 mb-8">
                <div>
                    <label class="block text-xs font-bold text-left mb-1 uppercase tracking-widest">Player 1 Name</label>
                    <input type="text" id="p1-name-input" placeholder="Enter Name" class="w-full bg-zinc-800 p-3 rounded border border-zinc-700 focus:outline-none focus:border-yellow-500">
                </div>
                <div>
                    <label class="block text-xs font-bold text-left mb-1 uppercase tracking-widest">Player 2 Name</label>
                    <input type="text" id="p2-name-input" placeholder="Enter Name" class="w-full bg-zinc-800 p-3 rounded border border-zinc-700 focus:outline-none focus:border-yellow-500">
                </div>
            </div>
            <button onclick="startGame()" class="w-full bg-yellow-500 text-black font-black py-4 rounded-xl hover:bg-yellow-400 transition transform hover:scale-105">START MATCH</button>
        </div>
    </div>

    <div class="pitch">
        <div class="score-board">
            <div id="p1-board" class="player-score active-turn">
                <div id="p1-display-name" class="font-bold">Player 1</div>
                <div id="p1-total" class="text-3xl font-black">0</div>
                <div id="p1-dots" class="shot-dots"></div>
            </div>
            <div id="p2-board" class="player-score">
                <div id="p2-display-name" class="font-bold">Player 2</div>
                <div id="p2-total" class="text-3xl font-black">0</div>
                <div id="p2-dots" class="shot-dots"></div>
            </div>
        </div>

        <div id="action-msg">
            <div id="turn-instruction">Waiting...</div>
            <div id="live-commentary" class="commentary-text">âœ¨ "Ready for some Pwadeep Nayunun insights?"</div>
        </div>

        <div class="goal-post">
            <div class="target-btn" style="grid-area: tl;" onclick="selectTarget(2)">TL</div>
            <div class="target-btn" style="grid-area: tr;" onclick="selectTarget(1)">TR</div>
            <div class="target-btn" style="grid-area: mid;" onclick="selectTarget(5)">M</div>
            <div class="target-btn" style="grid-area: bl;" onclick="selectTarget(4)">BL</div>
            <div class="target-btn" style="grid-area: br;" onclick="selectTarget(3)">BR</div>
        </div>

        <div class="ball-area" id="ball-container" onclick="kickBall()">
            <div id="ring" class="power-ring"></div>
            <div class="ball"></div>
        </div>

        <div class="mb-4 text-center opacity-70">
            <p id="instruction">Striker: Choose a target, then tap the ball when the ring is GREEN!</p>
        </div>
    </div>

    <div id="gk-modal" class="modal">
        <div class="bg-zinc-900 p-8 rounded-2xl border-2 border-white max-w-sm w-full text-center">
            <h2 id="gk-title" class="text-2xl font-bold mb-2">GOALKEEPER</h2>
            <p class="mb-6 opacity-80">Guess where they will shoot!</p>
            <div class="grid grid-cols-3 gap-4 mb-6">
                <button onclick="gkSelect(2)" class="p-4 bg-zinc-800 rounded hover:bg-zinc-700 font-bold">Top L</button>
                <div class="flex items-center justify-center font-bold text-zinc-600">GK</div>
                <button onclick="gkSelect(1)" class="p-4 bg-zinc-800 rounded hover:bg-zinc-700 font-bold">Top R</button>
                <button onclick="gkSelect(4)" class="p-4 bg-zinc-800 rounded hover:bg-zinc-700 font-bold">Bot L</button>
                <button onclick="gkSelect(5)" class="p-4 bg-zinc-800 rounded hover:bg-zinc-700 font-bold">Mid</button>
                <button onclick="gkSelect(3)" class="p-4 bg-zinc-800 rounded hover:bg-zinc-700 font-bold">Bot R</button>
            </div>
        </div>
    </div>

    <div id="result-modal" class="modal">
        <div class="bg-zinc-900 p-10 rounded-2xl border-4 border-yellow-500 text-center max-w-lg w-full">
            <h1 id="winner-text" class="text-5xl font-black mb-4 italic">WINNER!</h1>
            <p id="final-score" class="text-xl mb-4">Score: 0 - 0</p>
            
            <div id="ai-report-container" class="mb-6 hidden">
                <div class="bg-zinc-800 p-4 rounded-lg text-left text-sm overflow-y-auto max-h-48 border border-zinc-700">
                    <div class="text-yellow-500 font-bold mb-2">âœ¨ Pwadeep Nayunun's Post-Match Analysis</div>
                    <div id="ai-report-content" class="text-zinc-300 italic">Analyzing...</div>
                </div>
            </div>

            <div class="flex flex-col gap-3">
                <button id="report-btn" onclick="generateMatchReport()" class="bg-blue-600 text-white font-bold px-8 py-3 rounded-full hover:bg-blue-500 transition italic">âœ¨ CALL PWADEEP FOR ANALYSIS</button>
                <button onclick="location.reload()" class="bg-yellow-500 text-black font-bold px-8 py-3 rounded-full hover:bg-yellow-400 transition">REMATCH</button>
            </div>
        </div>
    </div>

    <script>
        // --- Gemini API Setup ---
        const apiKey = "";
        
        async function callGemini(prompt) {
            try {
                let delay = 1000;
                for (let i = 0; i < 5; i++) {
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: prompt }] }]
                        })
                    });
                    if (response.ok) {
                        const data = await response.json();
                        return data.candidates?.[0]?.content?.parts?.[0]?.text;
                    }
                    await new Promise(r => setTimeout(r, delay));
                    delay *= 2;
                }
            } catch (error) { return null; }
        }

        // --- Game State ---
        let gameState = {
            p1Name: "Player 1",
            p2Name: "Player 2",
            striker: 1,
            goalkeeper: 2,
            p1Score: [],
            p2Score: [],
            shotLog: [],
            strikerTarget: null,
            gkTarget: null,
            powerPhase: 0,
            powerDirection: 1,
            speed: 0.8,
            isSuddenDeath: false,
            isProcessing: false,
            gameStarted: false
        };

        const targetNames = { 1: "Top Right", 2: "Top Left", 3: "Bottom Right", 4: "Bottom Left", 5: "Middle" };
        const ring = document.getElementById('ring');
        const gkModal = document.getElementById('gk-modal');
        const setupModal = document.getElementById('setup-modal');
        const resultModal = document.getElementById('result-modal');
        const commElement = document.getElementById('live-commentary');

        function startGame() {
            const p1 = document.getElementById('p1-name-input').value.trim();
            const p2 = document.getElementById('p2-name-input').value.trim();
            if (p1) gameState.p1Name = p1;
            if (p2) gameState.p2Name = p2;

            document.getElementById('p1-display-name').innerText = gameState.p1Name;
            document.getElementById('p2-display-name').innerText = gameState.p2Name;
            
            setupModal.classList.remove('active');
            gameState.gameStarted = true;
            nextTurn();
            animateRing();
        }

        function updateDots() {
            const p1Dots = document.getElementById('p1-dots');
            const p2Dots = document.getElementById('p2-dots');
            p1Dots.innerHTML = ''; p2Dots.innerHTML = '';

            for (let i = 0; i < Math.max(5, gameState.p1Score.length); i++) {
                const dot1 = document.createElement('div');
                dot1.className = 'dot ' + (gameState.p1Score[i] === true ? 'scored' : gameState.p1Score[i] === false ? 'missed' : '');
                p1Dots.appendChild(dot1);
                const dot2 = document.createElement('div');
                dot2.className = 'dot ' + (gameState.p2Score[i] === true ? 'scored' : gameState.p2Score[i] === false ? 'missed' : '');
                p2Dots.appendChild(dot2);
            }
        }

        function animateRing() {
            if (gameState.isProcessing || !gameState.gameStarted) return;
            gameState.powerPhase += gameState.speed * gameState.powerDirection;
            if (gameState.powerPhase >= 100 || gameState.powerPhase <= 0) gameState.powerDirection *= -1;
            const size = 60 + (gameState.powerPhase * 1.5);
            ring.style.width = size + 'px'; ring.style.height = size + 'px';

            if (gameState.powerPhase > 15 && gameState.powerPhase < 50) {
                ring.style.borderColor = '#22c55e'; ring.dataset.status = 'good';
            } else {
                ring.style.borderColor = '#ef4444'; ring.dataset.status = 'bad';
            }
            requestAnimationFrame(animateRing);
        }

        function selectTarget(num) {
            if (gameState.isProcessing) return;
            gameState.strikerTarget = num;
            document.querySelectorAll('.target-btn').forEach(btn => btn.classList.remove('selected'));
            event.currentTarget.classList.add('selected');
        }

        function kickBall() {
            if (gameState.isProcessing || !gameState.strikerTarget) return;
            if (ring.dataset.status !== 'good') {
                processResult(false, "OUT OF BOUNDS!", "MISS");
            } else {
                const gkName = gameState.goalkeeper === 1 ? gameState.p1Name : gameState.p2Name;
                document.getElementById('gk-title').innerText = gkName;
                gkModal.classList.add('active');
            }
        }

        function gkSelect(num) {
            gameState.gkTarget = num;
            gkModal.classList.remove('active');
            if (gameState.gkTarget === gameState.strikerTarget) {
                processResult(false, "SAVED!", "SAVE");
            } else {
                processResult(true, "GOAL!!!", "GOAL");
            }
        }

        async function processResult(isGoal, mainMsg, type) {
            gameState.isProcessing = true;
            document.getElementById('turn-instruction').innerText = mainMsg;
            commElement.innerText = "âœ¨ Pwadeep is checking his notes...";

            const strikerName = gameState.striker === 1 ? gameState.p1Name : gameState.p2Name;
            const gkName = gameState.goalkeeper === 1 ? gameState.p1Name : gameState.p2Name;

            gameState.shotLog.push({ striker: strikerName, keeper: gkName, target: targetNames[gameState.strikerTarget], result: type });

            const prompt = `Act as Pwadeep Nayunun, a legendary, humorous, and highly enthusiastic football commentator. ${strikerName} just shot at ${targetNames[gameState.strikerTarget]} against keeper ${gkName}. Result: ${type}. Give a short (max 10 words) hilarious Pwadeep-style reaction.`;
            
            callGemini(prompt).then(commentary => {
                if (commentary) commElement.innerText = `âœ¨ "${commentary.trim().replace(/"/g, '')}"`;
            });

            const currentScores = gameState.striker === 1 ? gameState.p1Score : gameState.p2Score;
            currentScores.push(isGoal);
            updateScoreUI();
            setTimeout(() => checkGameEnd(), 2500);
        }

        function updateScoreUI() {
            document.getElementById('p1-total').innerText = gameState.p1Score.filter(x => x === true).length;
            document.getElementById('p2-total').innerText = gameState.p2Score.filter(x => x === true).length;
            updateDots();
        }

        function checkGameEnd() {
            const p1Scored = gameState.p1Score.filter(x => x === true).length;
            const p2Scored = gameState.p2Score.filter(x => x === true).length;
            const p1Taken = gameState.p1Score.length;
            const p2Taken = gameState.p2Score.length;

            if (!gameState.isSuddenDeath) {
                const p1Rem = 5 - p1Taken; const p2Rem = 5 - p2Taken;
                if (p1Scored > p2Scored + p2Rem || p2Scored > p1Scored + p1Rem) return endGame();
                if (p1Taken >= 5 && p2Taken >= 5) {
                    if (p1Scored === p2Scored) {
                        gameState.isSuddenDeath = true;
                        document.getElementById('turn-instruction').innerText = "SUDDEN DEATH!";
                    } else return endGame();
                }
            } else if (p1Taken === p2Taken && p1Scored !== p2Scored) return endGame();
            nextTurn();
        }

        function nextTurn() {
            if (gameState.striker === 1) { gameState.striker = 2; gameState.goalkeeper = 1; }
            else { gameState.striker = 1; gameState.goalkeeper = 2; }
            const activeName = gameState.striker === 1 ? gameState.p1Name : gameState.p2Name;
            gameState.strikerTarget = null; gameState.gkTarget = null; gameState.isProcessing = false;
            document.querySelectorAll('.target-btn').forEach(btn => btn.classList.remove('selected'));
            document.getElementById('p1-board').className = 'player-score ' + (gameState.striker === 1 ? 'active-turn' : '');
            document.getElementById('p2-board').className = 'player-score ' + (gameState.striker === 2 ? 'active-turn' : '');
            document.getElementById('turn-instruction').innerText = `${activeName}: Aim & Shoot!`;
            if (gameState.gameStarted) requestAnimationFrame(animateRing);
        }

        function endGame() {
            const p1S = gameState.p1Score.filter(x => x === true).length;
            const p2S = gameState.p2Score.filter(x => x === true).length;
            const winner = p1S > p2S ? gameState.p1Name : gameState.p2Name;
            document.getElementById('winner-text').innerText = `${winner.toUpperCase()} WINS!`;
            document.getElementById('final-score').innerText = `${gameState.p1Name} ${p1S} - ${p2S} ${gameState.p2Name}`;
            resultModal.classList.add('active');
        }

        async function generateMatchReport() {
            const content = document.getElementById('ai-report-content');
            document.getElementById('report-btn').classList.add('hidden');
            document.getElementById('ai-report-container').classList.remove('hidden');
            content.innerText = "Pwadeep is grabbing a mic... ðŸŽ™ï¸";

            const log = gameState.shotLog.map(s => `${s.striker} vs ${s.keeper} at ${s.target}: ${s.result}`).join("\n");
            const prompt = `Act as Pwadeep Nayunun. Write a final match report for this shootout:\n${log}\n\nStyle: Hilarious, enthusiastic, uses football slang, and highly specific about the players' names. Max 80 words.`;
            
            const analysis = await callGemini(prompt);
            content.innerText = analysis || "Pwadeep's microphone broke! What a match regardless!";
        }

        updateDots();
    </script>
</body>
</html>